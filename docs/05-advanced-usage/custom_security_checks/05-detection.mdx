---
title: Detection
---

# Detection

In your security test, you must define what are the criteria to raise an alert.
For that you have a lot of matchers available to match on the request, the response, the schema or the scan type.

The detection block is a list of detection rules, each rule is evaluated independently and if all the rules are matched,
an alert is raised. This means that you can define multiple matchers to fine tune your detection.

For example, a check that will raise an alert if the response status code is 500 to a route that contains `debug` in the url :

```yaml
detection:
  - detect: response.status_code
    is: 500
  - detect: schema.url
    contains: "debug"
```

## Available keys

With all the aforementioned matchers, you can match on the following keys :

- [scan.type](#scantype)
- [schema.operation](#schemaoperation)
- [schema.need_authentication](#schemaneed_authentication)
- [schema.url](#schemaurl)
- [schema.method](#schemamethod)
- [request.is_authenticated](#requestis_authenticated)
- [request.user](#requestuser)
- [request.headers](#requestheaders)
- [request.body](#requestbody)
- [helpers.request.scalars](#helpersrequestscalars)
- [helpers.request.crud](#helpersrequestcrud)
- [response.status_code](#responsestatus_code)
- [response.duration_ms](#responseduration_ms)
- [response.headers](#responseheaders)
- [response.body](#responsebody)
- [helpers.response.scalars](#helpersresponsescalars)
- [helpers.response.is_successful](#helpersresponseis_successful)

### scan.type

> type: [`enum`](#enum-matcher)

You can test the scan type to run some specific tests only for specific applications.

Example :

```yaml
detection:
  - detect: scan.type
    is: "REST"
```

### schema.operation

> type: [`string`](#string-matcher)

The operation is an agnostic way to describe the action that is performed by the request.
It will match the operation in graphql, the path in REST, the verb in gRPC, etc...

```yaml
detection:
  - detect: scan.type
    is: "REST"
```


### schema.need_authentication

> type: [`bool`](#boolean-matcher)

You can filter only the authenticated routes with this detection.

Example :

```yaml
detection:
  - detect: schema.need_authentication
    is: true
```

### schema.url

> type: `aaa`

Example :

```yaml
detection:
  - detect: scan.type
    is: "REST"
```

### schema.method

> type: `[enum](#enum-matcher)`

Example :

```yaml
detection:
  - detect: scan.type
    is: "REST"
```

### request.is_authenticated

> type: [`bool`](#boolean-matcher)

Example :

```yaml
detection:
  - detect: scan.type
    is: "REST"
```

### request.user

> type: [`string`](#string-matcher)

Example :
```yaml
detection:
  - detect: 
    
```

### request.headers

> type: [`dict`](#dictionary-matcher)

Example :
```yaml
detection:
  - detect: 
    
```

### request.body

> type: [`string`](#string-matcher) / [`JSON`](#json-matcher)

Example :
```yaml
detection:
  - detect: request.body
    is: "OK" # string matcher
    # or 
    contains: "admin_password=" # string matcher
    # or
    is: {"user": "admin"} # JSON Matcher
    # or
    in: # JSON matcher
    - {"user": "admin"}
    - {"isAdmin": true}
    # or
    jq: '.user == "admin" or .isAdmin' # JSON Matcher
```

### helpers.request.scalars

> type: [`string`](#string-matcher) / [`enum`](#enum-matcher)

Example :
```yaml
# matching the email of an admin that is not admin@escape.tech
detection:
  - detect: helpers.request.scalars
    type:
      in:
        - "EMAIL"
    name:
      # string matcher
      regex: ".*admin.*" # admin_email, email_of_admin, etc...
    value:
      # string matcher
      is_not: "admin@escape.tech"
```



### helpers.request.crud

> type: [`enum`](#enum-matcher)

Example :
```yaml
detection:
  - detect:
    
```

### response.status_code

> type: [`integer`](#integer-matcher)

Example :
```yaml
detection:
  - detect: 
    
```

### response.duration_ms

> type: [`integer`](#integer-matcher)

Example :
```yaml
detection:
  - detect: 
    
```

### response.headers

> type: [`dict`](#dictionary-matcher)

Example :
```yaml
detection:
  - detect: 
    
```

### response.body

> type: [`string`](#string-matcher) / [`dict`](#dictionary-matcher) / [`JSON`](#json-matcher)

Example :
```yaml
detection:
  - detect: 
    
```

### helpers.response.scalars

> type: [`string`](#string-matcher) / [`enum`](#enum-matcher)

Example :
```yaml
# matching the email of an admin that is not admin@escape.tech
detection:
  - detect: helpers.request.scalars
    type:
      in:
        - "EMAIL"
    name:
      # string matcher
      regex: ".*admin.*" # admin_email, email_of_admin, etc...
    value:
      # string matcher
      is_not: "admin@escape.tech"
```

### helpers.response.is_successful

> type: [`bool`](#boolean-matcher)

Example :
```yaml
detection:
  - detect: 
    
```

## Matchers

There are various types of matchers available:

- [Boolean](#boolean-matcher)
- [String](#string-matcher)
- [Integer](#integer-matcher)
- [Enum](#enum-matcher)
- [Dictionary](#dictionary-matcher)
- [JSON](#json-matcher)
- [Scalar](#scalar-matcher)

### Boolean matcher

You can match over a boolean with the simple `is` matcher.

Example :

```yaml
detection:
  - detect: helpers.response.is_successful
    is: true
```

### String matcher

You can match over a string in a lot of different ways :

- `is` : The string is exactly the same
- `in` : The string is in the given list
- `contains` : The string contains the given value
- `regex` : The string full match the given regex with ignore case flag (you can try your regex [here](https://regex101.com/))

Example :

```yaml
detection:
  - detect: schema.url
    contains: "admin"
```

### Integer matcher

You can match over a integer in a lot of different ways :

- `is` : The integer is equal
- `is_not` : The integer is not equal
- `in` : The integer is in the given list
- `gt` : The integer is greater than the given value (or equal)
- `lt` : The integer is lower than the given value (or equal)

You can combine `gt` and `lt` to create a range.

Example :

```yaml
detection:
  - detect: response.status_code
    gt: 200
    lt: 299
```

### Enum matcher

Some keys contain a single value from an Enum that contains valid values.
Autocompletion should suggest them to you, depending on the key.
e.g. `helpers.request.crud` accepts `CREATE`, `READ`, `UPDATE`, `DELETE`.
`schema.method` accepts `GET`, `POST`, `PUT`, `PATCH`, `DELETE`, `OPTIONS`, `HEAD`.

Example : 

```yaml
detection:
  - detect: helpers.request.crud # (= "CREATE")
    in:
      - "CREATE"
      - "READ"
```

### Dictionary matcher

For data that is structured as a dictionary of key-values and you want to match on both the key and value.

Example:

```yaml
detection:
  - detect: request.header
    key:
      # string matcher
      is: "Content-Type"
    value:
      # string matcher
      regex: "application/.*"
```

### JSON matcher

You can match over a JSON in a lot of different ways :

- `is` : The JSON is exactly the same as the given JSON
- `in` : The JSON is in the given list of JSON
- `jq` : The string match the given [jq](https://stedolan.github.io/jq/) filter

Example:

```yaml
detection:
  - detect: request.body
    is: {"user": "admin"}
    # or
    in: 
    - {"user": "admin"}
    - {"isAdmin": true}
    # or
    jq: '.user == "admin" or .isAdmin'
```

### Scalar matcher

Escape explore your API using scalars : each key of the query and the response will be extracted and stored as a scalar.
It can be helpful to understand what is the underlying type of a key in a from.

For example you may have a `user_id` key typed as string in your json schema, but in the underlying database store it as an UUID,
escape will tag this key as `ID` and `UUID`, and during the scan, this scalars will be refined to `UUID` only.

You so can match the scalar type using an enum matcher with our predefined scalars :

```yaml
detection:
  - detect: helpers.response.scalars
    type:
      in:
        - "IPV4"
        - "IPV6"
```

You can also match a scalar by it's name in your specification, using a string matcher :

```yaml
detection:
  - detect: helpers.response.scalars
    name:
      # string matcher
      is: "user_id"
```
You can also match a scalar by value using a string matcher :

```yaml
detection:
  - detect: helpers.response.scalars
    value:
      # string matcher
      regex: ".*@escape.tech"
```

You can also match on the sensitivity of a scalar using an enum matcher:

```yaml
detection:
  - detect: helpers.response.scalars
    sensitivity:
      in:
        - "HIGH"
        - "MEDIUM"
```

You can merge all of these matchers to create a complex detection rule :

```yaml
# matching the email of an admin that is not admin@escape.tech
detection:
  - detect: response.status_code
    is: 200
  - detect: helpers.response.scalars
    type:
      in:
        - "EMAIL"
    name:
      # string matcher
      regex: ".*admin.*" # admin_email, email_of_admin, etc...
    value:
      # string matcher
      is_not: "admin@escape.tech"
```
